{
	"_id": "561c3d8ee4ce9f86050d1bb1",
	"slug": "oasisreferee",
	"searchStrings": "oasis referee o oa oas oasi oasis oasisr oasisre oasisref oasisrefe oasisrefer",
	"name": "OasisReferee",
	"js": "var OasisReferee, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nOasisReferee = (function(_super) {\n  __extends(OasisReferee, _super);\n\n  function OasisReferee() {\n    _ref = OasisReferee.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  OasisReferee.className = 'OasisReferee';\n\n  OasisReferee.prototype.chooseAction = function() {\n    if (!this.oasisSetUp) {\n      this.setUpOasis();\n    }\n    this.spawnMinions();\n    this.controlMinions();\n    return this.checkOasisVictory();\n  };\n\n  OasisReferee.prototype.setUpOasis = function() {\n    var hero, i, spawnOptions, t, y1, y2;\n    this.oasisSetUp = true;\n    this.leftX = 8;\n    this.rightX = 72;\n    this.bottomY = 0;\n    this.topY = 60;\n    hero = this.world.getThangByID('Hero Placeholder');\n    if (hero.maxSpeed === 13) {\n      hero.maxSpeed = 12;\n    }\n    this.yakTimeFactor = hero.maxSpeed / 8;\n    if (this.yakTimeFactor === 1.0625) {\n      this.yakTimeFactor = 1.1;\n    }\n    console.log('got yakTimeFactor', this.yakTimeFactor, 'from hero speed', hero.maxSpeed);\n    y1 = (this.world.rand.randf() < 0.5 ? this.bottomY - 3 : this.topY + 3);\n    y2 = y1 === this.topY + 3 ? this.bottomY - 3 : this.topY + 3;\n    t = this.world.age;\n    spawnOptions = [\n      [\n        {\n          type: 'sand-yak',\n          x: 15,\n          y: y1,\n          speed: .35,\n          at: t + 1,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 25,\n          y: y2,\n          speed: .65,\n          at: t,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 35,\n          y: y2,\n          speed: .35,\n          at: t + 2,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 45,\n          y: y1,\n          speed: .55,\n          at: t,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 55,\n          y: y2,\n          speed: .65,\n          at: t + 2,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 25,\n          y: y2,\n          speed: .65,\n          at: t + 8,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 35,\n          y: y2,\n          speed: .35,\n          at: t + 7,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 45,\n          y: y1,\n          speed: .55,\n          at: t + 8,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 55,\n          y: y2,\n          speed: .37,\n          at: t + 9,\n          did: 0\n        }\n      ], [\n        {\n          type: 'sand-yak',\n          x: 15,\n          y: y2,\n          speed: .40,\n          at: t + 2,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 20,\n          y: y1,\n          speed: .35,\n          at: t + 1,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 35,\n          y: y2,\n          speed: 1.05,\n          at: t,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 45,\n          y: y2,\n          speed: .52,\n          at: t + 1,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 55,\n          y: y1,\n          speed: .35,\n          at: t + 2,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 25,\n          y: y1,\n          speed: .35,\n          at: t + 7,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 35,\n          y: y2,\n          speed: .95,\n          at: t + 9,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 45,\n          y: y2,\n          speed: .52,\n          at: t + 10,\n          did: 0\n        }, {\n          type: 'sand-yak',\n          x: 55,\n          y: y1,\n          speed: .35,\n          at: t + 8,\n          did: 0\n        }\n      ]\n    ];\n    i = Math.floor(this.world.rand.randf() * spawnOptions.length);\n    console.log('got spawn options', i);\n    return this.spawns = spawnOptions[i];\n  };\n\n  OasisReferee.prototype.spawnMinions = function() {\n    var spawn, _i, _len, _ref1, _results;\n    _ref1 = this.spawns;\n    _results = [];\n    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n      spawn = _ref1[_i];\n      if (spawn.did * 10 < this.world.age && this.world.age >= spawn.at + spawn.did * 10 / this.yakTimeFactor) {\n        _results.push(this.spawnMinion(spawn));\n      } else {\n        _results.push(void 0);\n      }\n    }\n    return _results;\n  };\n\n  OasisReferee.prototype.spawnMinion = function(spawn) {\n    var buildType, thang;\n    spawn.did += 1;\n    buildType = spawn.type;\n    this.buildXY(buildType, spawn.x, spawn.y);\n    thang = this.performBuild();\n    thang.move({\n      x: spawn.x,\n      y: (spawn.y < 30 ? this.topY + 10 : this.bottomY - 10)\n    });\n    thang.maxSpeed *= this.yakTimeFactor;\n    thang.currentSpeedRatio = spawn.speed;\n    if (buildType === 'sand-yak') {\n      thang.scaleFactor = 1.20 + 1.05 * this.world.rand.randf();\n      return thang.keepTrackedProperty('scaleFactor');\n    }\n  };\n\n  OasisReferee.prototype.controlMinions = function() {\n    var aggroDistance, hero, minion, _i, _len, _ref1, _results;\n    hero = this.world.getThangByID('Hero Placeholder');\n    _ref1 = this.built;\n    _results = [];\n    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n      minion = _ref1[_i];\n      if (!minion.team) {\n        continue;\n      }\n      aggroDistance = minion.type === 'sand-yak' ? 5 : 10;\n      if (minion.pos.y > this.topY + 3 || minion.pos.y < this.bottomY - 3) {\n        _results.push(minion.setExists(false));\n      } else if ((minion.distanceTo(hero) < aggroDistance) || minion.hadAttackedHero) {\n        minion.attack(hero);\n        minion.hadAttackedHero = true;\n        _results.push(minion.specificAttackTarget = hero);\n      } else {\n        _results.push(void 0);\n      }\n    }\n    return _results;\n  };\n\n  OasisReferee.prototype.checkOasisVictory = function() {\n    var hero, minionsAttacking, t;\n    if (this.victoryChecked) {\n      return;\n    }\n    hero = this.world.getThangByID('Hero Placeholder');\n    minionsAttacking = ((function() {\n      var _i, _len, _ref1, _results;\n      _ref1 = this.built;\n      _results = [];\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        t = _ref1[_i];\n        if (t.exists && t.health > 0 && t.hadAttackedHero) {\n          _results.push(t);\n        }\n      }\n      return _results;\n    }).call(this)).length;\n    if ((!minionsAttacking || this.world.age > 39.8) && hero.pos.x > this.rightX - 10) {\n      this.victoryChecked = true;\n      this.setGoalState('get-to-oasis', 'success');\n      return this.world.endWorld(true, 1);\n    }\n  };\n\n  return OasisReferee;\n\n})(Component);\n",
	"system": "misc",
	"creator": "512ef4805a67a8c507000001",
	"original": "5480ba971bf0b10000711c66",
	"watchers": [
		"512ef4805a67a8c507000001",
		"5162fab9c92b4c751e000274"
	],
	"__v": 0,
	"commitMessage": "Fixed speed 13 to 12 to get it to work, megakludge!",
	"parent": "5522b0ae990de395ee88a3cd",
	"patches": [],
	"index": true,
	"created": "2015-10-12T23:09:02.610Z",
	"version": {
		"isLatestMinor": true,
		"isLatestMajor": true,
		"minor": 13,
		"major": 0
	},
	"permissions": [
		{
			"access": "owner",
			"target": "512ef4805a67a8c507000001"
		},
		{
			"access": "read",
			"target": "public"
		}
	]
}