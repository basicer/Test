{
	"_id": "54e14b87ce18e351054e06bc",
	"slug": "wildhorsesreferee",
	"searchStrings": "wild horses referee w wi wil wild wildh wildho wildhor wildhors wildhorse wildhorses wildhorsesr wildhorsesre wildhorsesref wildhorsesrefe wildhorsesrefer",
	"name": "WildHorsesReferee",
	"js": "var WildHorsesReferee, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nWildHorsesReferee = (function(_super) {\n  __extends(WildHorsesReferee, _super);\n\n  function WildHorsesReferee() {\n    _ref = WildHorsesReferee.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  WildHorsesReferee.className = 'WildHorsesReferee';\n\n  WildHorsesReferee.prototype.chooseAction = function() {\n    this.configure();\n    this.decrementTimers();\n    return this.horsesRoutine();\n  };\n\n  WildHorsesReferee.prototype.setUpLevel = function() {\n    this.hero = this.world.getThangByID('Hero Placeholder');\n    this.referee = this.world.getThangByID('Referee Horse');\n    this.horseFollowing = false;\n    this.tagHorse = false;\n    return this.numHorses = 6;\n  };\n\n  WildHorsesReferee.prototype.configure = function() {\n    var horse, t, wildHorses, _i, _len;\n    if (!!this.configured) {\n      return;\n    }\n    this.buildHorses();\n    wildHorses = (function() {\n      var _i, _len, _ref1, _results;\n      _ref1 = this.world.thangs;\n      _results = [];\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        t = _ref1[_i];\n        if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n          _results.push(t);\n        }\n      }\n      return _results;\n    }).call(this);\n    for (_i = 0, _len = wildHorses.length; _i < _len; _i++) {\n      horse = wildHorses[_i];\n      horse.moveDelay = 0;\n    }\n    return this.configured = true;\n  };\n\n  WildHorsesReferee.prototype.decrementTimers = function() {\n    var horse, name, t, timer, wildHorses, _i, _len, _ref1, _results;\n    _ref1 = this.timers;\n    for (name in _ref1) {\n      timer = _ref1[name];\n      this.timers[name] -= this.world.dt;\n    }\n    wildHorses = (function() {\n      var _i, _len, _ref2, _results;\n      _ref2 = this.world.thangs;\n      _results = [];\n      for (_i = 0, _len = _ref2.length; _i < _len; _i++) {\n        t = _ref2[_i];\n        if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n          _results.push(t);\n        }\n      }\n      return _results;\n    }).call(this);\n    _results = [];\n    for (_i = 0, _len = wildHorses.length; _i < _len; _i++) {\n      horse = wildHorses[_i];\n      _results.push(horse.moveDelay -= this.world.dt);\n    }\n    return _results;\n  };\n\n  WildHorsesReferee.prototype.findRandomPos = function(unit) {\n    var dx, dy, r;\n    r = Math.round(this.world.rand.randf2(1, 10));\n    if (r === 1 || !unit.currentHeading) {\n      unit.currentHeading = Math.random() * Math.PI * 2;\n    }\n    dx = 7 * Math.cos(unit.currentHeading);\n    dy = 7 * Math.sin(unit.currentHeading);\n    return {\n      x: Math.round(unit.pos.x + dx),\n      y: Math.round(unit.pos.y + dy)\n    };\n  };\n\n  WildHorsesReferee.prototype.horsesRoutine = function() {\n    this.tagHorses();\n    this.followHorses();\n    this.checkHorseGoal();\n    return this.roamHorses();\n  };\n\n  WildHorsesReferee.prototype.buildHorses = function() {\n    var i, pos, _i, _ref1, _results;\n    _results = [];\n    for (i = _i = 1, _ref1 = this.numHorses; _i <= _ref1; i = _i += 1) {\n      pos = this.pickPointFromRegions([this.rectangles[\"horse-spawn\"]]);\n      _results.push(this.instabuild(\"wild-horse\", pos.x, pos.y));\n    }\n    return _results;\n  };\n\n  WildHorsesReferee.prototype.tagHorses = function() {\n    var closestHorse, horse, t, wildHorses, _i, _len;\n    if (this.tagHorse && this.horseFollowing) {\n      return this.tagHorse = false;\n    } else if (this.tagHorse && !this.horseFollowing) {\n      closestHorse = false;\n      wildHorses = (function() {\n        var _i, _len, _ref1, _results;\n        _ref1 = this.world.thangs;\n        _results = [];\n        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n          t = _ref1[_i];\n          if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n            _results.push(t);\n          }\n        }\n        return _results;\n      }).call(this);\n      for (_i = 0, _len = wildHorses.length; _i < _len; _i++) {\n        horse = wildHorses[_i];\n        horse.distance = this.hero.distanceTo(horse);\n        if (!closestHorse) {\n          closestHorse = horse;\n        } else if (horse.distance < closestHorse.distance) {\n          closestHorse = horse;\n        }\n      }\n      if (closestHorse.distance <= 15) {\n        closestHorse.tagged = true;\n        return this.tagHorse = false;\n      }\n    }\n  };\n\n  WildHorsesReferee.prototype.followHorses = function() {\n    var horse, t, wildHorses, _i, _len, _results;\n    if (!this.tagHorse) {\n      wildHorses = (function() {\n        var _i, _len, _ref1, _results;\n        _ref1 = this.world.thangs;\n        _results = [];\n        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n          t = _ref1[_i];\n          if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n            _results.push(t);\n          }\n        }\n        return _results;\n      }).call(this);\n      _results = [];\n      for (_i = 0, _len = wildHorses.length; _i < _len; _i++) {\n        horse = wildHorses[_i];\n        if (horse.tagged) {\n          horse.following = true;\n          horse.tagged = false;\n          horse.maxSpeed = 20;\n          horse.addTrackedProperties(['maxSpeed', 'number']);\n          horse.keepTrackedProperty('maxSpeed');\n          _results.push(this.horseFollowing = true);\n        } else {\n          _results.push(void 0);\n        }\n      }\n      return _results;\n    }\n  };\n\n  WildHorsesReferee.prototype.roamHorses = function() {\n    var horse, pos, t, wildHorses, _i, _len, _results;\n    wildHorses = (function() {\n      var _i, _len, _ref1, _results;\n      _ref1 = this.world.thangs;\n      _results = [];\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        t = _ref1[_i];\n        if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n          _results.push(t);\n        }\n      }\n      return _results;\n    }).call(this);\n    _results = [];\n    for (_i = 0, _len = wildHorses.length; _i < _len; _i++) {\n      horse = wildHorses[_i];\n      if (!horse.following && horse.moveDelay <= 0) {\n        pos = this.findRandomPos(horse);\n        while (!this.isPathClear(horse.pos, pos) || (pos.x < 40 && pos.y > 43)) {\n          pos = this.findRandomPos(horse);\n        }\n        if (pos) {\n          horse.moveDelay = this.world.rand.randf2(0, 1.5);\n          _results.push(horse.move(pos));\n        } else {\n          _results.push(void 0);\n        }\n      } else if (horse.following) {\n        _results.push(horse.move(Vector.subtract(horse.pos, this.hero.pos).normalize().multiply(4).add(this.hero.pos)));\n      } else {\n        _results.push(void 0);\n      }\n    }\n    return _results;\n  };\n\n  WildHorsesReferee.prototype.checkHorseGoal = function() {\n    var horse, t, wildHorses, _i, _len, _results;\n    if (this.rectangles['horse-finish'].containsPoint(this.hero.pos)) {\n      wildHorses = (function() {\n        var _i, _len, _ref1, _results;\n        _ref1 = this.world.thangs;\n        _results = [];\n        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n          t = _ref1[_i];\n          if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n            _results.push(t);\n          }\n        }\n        return _results;\n      }).call(this);\n      _results = [];\n      for (_i = 0, _len = wildHorses.length; _i < _len; _i++) {\n        horse = wildHorses[_i];\n        if (horse.following && this.hero.distanceTo(horse) <= 15) {\n          this.horseFollowing = false;\n          horse.following = false;\n          horse.isAttackable = false;\n          _results.push(horse.move(this.pickPointFromRegions([this.rectangles[\"horse-farm\"]])));\n        } else {\n          _results.push(void 0);\n        }\n      }\n      return _results;\n    }\n  };\n\n  WildHorsesReferee.prototype.checkVictory = function() {\n    var t, wildHorses;\n    wildHorses = (function() {\n      var _i, _len, _ref1, _results;\n      _ref1 = this.world.thangs;\n      _results = [];\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        t = _ref1[_i];\n        if (t.type === \"wild-horse\" && t.exists && t.isAttackable) {\n          _results.push(t);\n        }\n      }\n      return _results;\n    }).call(this);\n    if (wildHorses.length <= 0) {\n      return this.setGoalState('capture-horses', 'success');\n    }\n  };\n\n  return WildHorsesReferee;\n\n})(Component);\n",
	"system": "misc",
	"creator": "546d4b4fa06acfd60c5ea198",
	"original": "54dbf0c37a193d5705f316f8",
	"watchers": [
		"546d4b4fa06acfd60c5ea198",
		"512ef4805a67a8c507000001",
		"5162fab9c92b4c751e000274"
	],
	"__v": 0,
	"commitMessage": "Added comments to methods",
	"index": true,
	"parent": "54e149915e066f5205e3c320",
	"created": "2015-02-16T01:44:39.369Z",
	"version": {
		"isLatestMinor": true,
		"isLatestMajor": true,
		"minor": 16,
		"major": 0
	},
	"permissions": [
		{
			"access": "owner",
			"target": "546d4b4fa06acfd60c5ea198"
		},
		{
			"access": "read",
			"target": "public"
		}
	]
}